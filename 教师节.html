<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰â¤ï¸ æ•™å¸ˆèŠ‚é™å®šå¡æ±  Â· æŠ½å¡æ¨¡æ‹Ÿ â¤ï¸ğŸ‰</title>
    <style>
      :root {
        --bg: radial-gradient(60% 50% at 10% 0%, #ffd1dc 0%, transparent 45%),
          radial-gradient(50% 50% at 90% 0%, #b5eaea 0%, transparent 50%),
          linear-gradient(180deg, #f9f7f7 0%, #e3f6f5 100%);
        --glass: rgba(255, 255, 255, 0.5);
        --border: rgba(150, 150, 150, 0.3);
        --primary: #ffbd87;
        --accent: #a3d8f4;
        --good: #7dcfb6;
        --bad: #ff9a8b;
        --text: #5a6270;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        color: var(--text);
        font-family: ui-rounded, "Segoe UI", "PingFang SC", "Hiragino Sans GB",
          "Helvetica Neue", Arial, "Noto Color Emoji", sans-serif;
        background: var(--bg);
        overflow-x: hidden;
        background-size: cover;
        background-attachment: fixed;
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        padding: 24px;
        padding-bottom: 120px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: wrap;
      }
      .title {
        display: flex;
        align-items: center;
        gap: 14px;
      }
      .logo {
        width: 56px;
        height: 56px;
        border-radius: 16px;
        background: linear-gradient(135deg, #ffd1dc, #ff9a8b 60%, #ffbd87);
        position: relative;
        box-shadow: 0 10px 30px rgba(255, 180, 180, 0.35);
      }
      .logo:before {
        content: "â¤";
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        font-size: 28px;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.35));
      }
      h1 {
        margin: 0;
        font-size: clamp(20px, 3vw, 28px);
      }
      .badge {
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 999px;
        background: var(--glass);
        backdrop-filter: blur(10px);
        font-size: 13px;
      }

      .panel {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0.4)
        );
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 16px;
        box-shadow: 0 15px 60px rgba(0, 0, 0, 0.1);
      }
      .grid {
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 18px;
      }
      @media (max-width: 940px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .btn {
        border: none;
        padding: 12px 16px;
        border-radius: 14px;
        cursor: pointer;
        color: #fff;
        font-weight: 700;
        letter-spacing: 0.4px;
        background: linear-gradient(90deg, #ff9a8b, #ffbd87);
        box-shadow: 0 8px 24px rgba(255, 157, 139, 0.35);
        transition: 0.25s transform, 0.25s filter, 0.25s box-shadow;
      }
      .btn:hover {
        transform: translateY(-2px);
        filter: saturate(1.06);
        box-shadow: 0 10px 36px rgba(255, 157, 139, 0.45);
      }
      .btn.secondary {
        background: linear-gradient(90deg, #a3d8f4, #b5eaea);
        box-shadow: 0 8px 24px rgba(163, 216, 244, 0.35);
      }
      .btn.ghost {
        background: var(--glass);
        color: var(--text);
        border: 1px dashed var(--border);
        box-shadow: none;
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .rollzone {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 14px;
        overflow: auto;
        scrollbar-gutter: stable;
        height: 630px;
      }
      .card {
        position: relative;
        height: 100px;
        width: 100%;
        border-radius: 16px;
        border: 1px solid var(--border);
        overflow: hidden;
        background: rgba(255, 255, 255, 0.6);
        display: grid;
        place-items: center;
        padding: 10px;
      }
      .card.big {
        grid-column: 1/-1;
        height: 180px;
      }
      .tag {
        position: absolute;
        top: 8px;
        left: 8px;
        font-size: 12px;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.7);
        border: 1px solid var(--border);
      }
      .card.r {
        background: linear-gradient(
          135deg,
          rgba(197, 232, 222, 0.55),
          rgba(186, 220, 255, 0.55)
        );
        border-color: rgba(160, 200, 255, 0.85);
      }
      .card.sr {
        background: linear-gradient(
          135deg,
          rgba(186, 220, 255, 0.6),
          rgba(147, 197, 253, 0.6)
        );
        border: 2px solid rgba(90, 170, 255, 0.85);
        animation: shine 2.4s linear infinite;
      }
      .card.ssr {
        background: radial-gradient(
            180px 80px at 80% -10%,
            rgba(255, 255, 255, 0.7),
            transparent 60%
          ),
          linear-gradient(
            135deg,
            rgba(255, 189, 135, 0.5),
            rgba(163, 216, 244, 0.5)
          );
        animation: shine 2.4s linear infinite;
        border-color: rgba(255, 189, 135, 0.8);
      }
      .card.ur {
        background: radial-gradient(
            220px 100px at 80% -10%,
            rgba(255, 255, 255, 0.9),
            transparent 60%
          ),
          radial-gradient(
            160px 80px at 20% 110%,
            rgba(255, 255, 255, 0.45),
            transparent 65%
          ),
          conic-gradient(
            from 210deg at 50% 50%,
            rgba(255, 196, 140, 0.65),
            rgba(210, 160, 255, 0.7),
            rgba(170, 200, 255, 0.65),
            rgba(255, 196, 140, 0.65)
          );
        border: 2px solid rgba(210, 160, 255, 1);
        box-shadow: 0 0 20px rgba(210, 160, 255, 0.6),
          0 0 46px rgba(255, 160, 200, 0.5),
          0 12px 55px rgba(170, 200, 255, 0.55);
        animation: shine 2.4s linear infinite, glow 3.6s ease-in-out infinite;
      }
      @keyframes shine {
        0% {
          filter: brightness(1);
        }
        50% {
          filter: brightness(1.18);
        }
        100% {
          filter: brightness(1);
        }
      }
      @keyframes glow {
        0% {
          box-shadow: 0 0 16px rgba(255, 196, 140, 0.55),
            0 0 40px rgba(255, 160, 200, 0.45),
            0 10px 50px rgba(170, 200, 255, 0.4);
        }
        50% {
          box-shadow: 0 0 32px rgba(255, 196, 140, 0.85),
            0 0 70px rgba(255, 160, 200, 0.65),
            0 14px 70px rgba(170, 200, 255, 0.55);
        }
        100% {
          box-shadow: 0 0 16px rgba(255, 196, 140, 0.55),
            0 0 40px rgba(255, 160, 200, 0.45),
            0 10px 50px rgba(170, 200, 255, 0.4);
        }
      }
      .resultText {
        text-align: center;
        line-height: 1.35;
        font-size: clamp(14px, 2.4vw, 18px);
      }
      .muted {
        color: #5a6270aa;
        font-size: 12px;
      }

      .flex {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }
      .between {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .history {
        min-height: 260px;
        max-height: 380px;
        overflow: auto;
        padding-right: 6px;
      }
      .historyItem {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 6px;
        border-bottom: 1px dashed var(--border);
      }
      .pill {
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.5);
      }

      .prob-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
        margin-top: 8px;
      }
      .prob-table th,
      .prob-table td {
        padding: 6px 8px;
        border-bottom: 1px dashed var(--border);
      }
      .prob-table th {
        text-align: left;
        color: var(--text);
        font-weight: 700;
      }
      .prob-table .p {
        text-align: right;
        color: #ff9a8b;
      }

      .chartWrap {
        height: 220px;
      }
      canvas#chart {
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 14px;
        border: 1px solid var(--border);
      }

      .notice {
        font-size: 13px;
        opacity: 0.9;
      }

      /* Barrage / å¼¹å¹• */
      .barrage {
        position: fixed;
        inset: 0 0 auto 0;
        pointer-events: none;
        z-index: 50;
        overflow: hidden;
      }
      .bullet {
        position: fixed;
        white-space: nowrap;
        left: 100%;
        top: 0;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.7);
        border: 1px solid var(--border);
        font-size: 13px;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        animation: fly linear forwards;
      }
      @keyframes fly {
        to {
          transform: translateX(calc(-100vw - 120%));
        }
      }

      /* Modal */
      .modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.3);
        display: none;
        place-items: center;
        z-index: 60;
      }
      .modal .inner {
        width: min(720px, 92vw);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0.4)
        );
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 16px;
      }

      /* Confetti */
      .confetti {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 70;
      }
      .confetti span {
        position: absolute;
        width: 8px;
        height: 14px;
        background: linear-gradient(180deg, #fff, #ffbd87);
        transform: rotate(0deg);
        opacity: 0.9;
        border-radius: 2px;
      }

      /* Footer */
      footer {
        position: fixed;
        inset: auto 0 0 0;
        padding: 8px 16px;
        display: flex;
        justify-content: center;
      }
      .footer {
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid var(--border);
        color: var(--text);
        font-size: 12px;
        padding: 6px 10px;
        border-radius: 10px;
        backdrop-filter: blur(8px);
      }

      /* Scrollbar niceness */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #b5eaea, #a3d8f4);
        border-radius: 10px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      .announcement {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        background: rgba(0, 0, 0, 0.5);
        z-index: 100;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .announcement.show {
        opacity: 1;
        pointer-events: all;
      }

      .announcement .inner {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 18px;
        padding: 24px 32px;
        max-width: 480px;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
        animation: pop 0.3s ease-out;
      }

      .announcement h2 {
        margin-top: 0;
        margin-bottom: 12px;
        font-size: 22px;
        color: #ff9a8b;
      }

      .announcement p {
        margin-bottom: 20px;
        font-size: 16px;
        line-height: 1.5;
        color: #5a6270;
      }

      .announcement .btn {
        background: linear-gradient(90deg, #ff9a8b, #ffbd87);
      }

      @keyframes pop {
        0% {
          transform: scale(0.8);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
    </style>
</head>
<body>
  <div class="barrage" id="barrage"></div> 
  <div class="confetti" id="confetti"></div> 
  <div class="wrap">
      <header>
      <div class="title">
          <div class="logo"></div>
          <div>
            <h1>ğŸ‰â¤ï¸ æ•™å¸ˆèŠ‚é™å®šå¡æ±  Â· æŠ½å¡æ¨¡æ‹Ÿ â¤ï¸ğŸ‰</h1>
            <div class="muted" style="margin-top: 4px">
              åˆ¶ä½œè€…ï¼šçç€šæ— è¾¹ &nbsp; | &nbsp; ç¥æ‰€æœ‰è€å¸ˆæ•™å¸ˆèŠ‚å¿«ä¹ï¼
          </div>
        </div>
      </div>
        <span class="badge">æŠ½å–æ—¥æœŸï¼š2025-09-10 ä¹‹å‰</span>
      </header>

      <div class="grid" style="margin-top: 16px">
        <section class="panel">
          <div class="between">
            <div class="flex">
              <button class="btn" id="roll1">å•æŠ½</button>
              <button class="btn secondary" id="roll10">åè¿</button>
              <button class="btn ghost" id="clear">æ¸…ç©ºè®°å½•</button>
            </div>
            <div class="pill" id="status">å°±ç»ª âœ…</div>
          </div>

          <div class="rollzone" id="rollzone"></div>
        </section>

        <aside class="panel">
          <div class="between" style="margin-bottom: 8px">
            <strong>å‡ºè´§ç»Ÿè®¡</strong>
            <span class="muted" id="total">0 æŠ½</span>
          </div>
          <div class="chartWrap">
            <canvas id="chart" width="647" height="330"></canvas>
          </div>

          <div class="between" style="margin-top: 16px">
            <strong>å†å²è®°å½•</strong>
            <button class="btn ghost" id="export">å¯¼å‡º</button>
          </div>
          <div class="history" id="history"></div>
        </aside>
      </div>

      <section class="panel" style="margin-top: 16px">
        <details open="">
          <summary style="cursor: pointer">
            <strong>æ¦‚ç‡å…¬ç¤º</strong>
            <span class="muted">* Tipï¼šSSR è¶…ä½æ¦‚ç‡ï¼Œéé…‹è¯·é‡åŠ›è€ŒæŠ½ã€‚</span>
          </summary>
          <table class="prob-table" id="probTable">
            <thead>
              <tr>
                <th>ç»“æœ</th>
                <th class="p">æ¦‚ç‡</th>
              </tr>
            </thead>
            <tbody><tr><td>æ»šä½ å¦ˆçš„ <span class="pill" style="margin-left:6px">R</span></td><td class="p">10%</td></tr><tr><td>å»ä½ å¦ˆçš„ <span class="pill" style="margin-left:6px">R</span></td><td class="p">10%</td></tr><tr><td>ä½ ä¹Ÿé…ï¼Ÿ <span class="pill" style="margin-left:6px">R</span></td><td class="p">10%</td></tr><tr><td>å‚»é€¼äºŒæ¬¡å…ƒ <span class="pill" style="margin-left:6px">R</span></td><td class="p">10%</td></tr><tr><td>ç™”ç—‡åˆçŠ¯äº†ï¼Ÿ <span class="pill" style="margin-left:6px">R</span></td><td class="p">10%</td></tr><tr><td>æ­»ç”·åŒçœŸæ¶å¿ƒ <span class="pill" style="margin-left:6px">SR</span></td><td class="p">5%</td></tr><tr><td>ç°åœ¨æ˜¯å¹»æƒ³æ—¶åˆ» <span class="pill" style="margin-left:6px">SR</span></td><td class="p">5%</td></tr><tr><td>æŸšå­å¨æ»šå‡ºå» <span class="pill" style="margin-left:6px">SR</span></td><td class="p">5%</td></tr><tr><td>è¿™æ˜¯æœ€åé€šç‰’ <span class="pill" style="margin-left:6px">SR</span></td><td class="p">5%</td></tr><tr><td>ä»¥åä¸è¦å†å’Œæˆ‘æ‰¯ä¸Šå…³ç³» <span class="pill" style="margin-left:6px">SR</span></td><td class="p">5%</td></tr><tr><td>è¢«æ‹‰é»‘+å±è”½ <span class="pill" style="margin-left:6px">SR</span></td><td class="p">5%</td></tr><tr><td>å°ç”·å¨˜ <span class="pill" style="margin-left:6px">SR</span></td><td class="p">5%</td></tr><tr><td>å‘æ¥ä¸€å¼ å¯çˆ±å›¾ç‰‡ <span class="pill" style="margin-left:6px">SR</span></td><td class="p">2.5%</td></tr><tr><td>æ”¶åˆ°ä¸€æ¡ä¿¡æ¯ <span class="pill" style="margin-left:6px">SR</span></td><td class="p">2.5%</td></tr><tr><td>ä¸‹æ¬¡å†è¯´å§ <span class="pill" style="margin-left:6px">SR</span></td><td class="p">2.5%</td></tr><tr><td>ä½ æ˜¯ä¸ªå¥½äºº <span class="pill" style="margin-left:6px">SR</span></td><td class="p">2.5%</td></tr><tr><td>æˆ‘ä¸€ç›´æŠŠä½ å½“å¥½æœ‹å‹ <span class="pill" style="margin-left:6px">SR</span></td><td class="p">2.5%</td></tr><tr><td>æ»šå‡ºå» <span class="pill" style="margin-left:6px">R</span></td><td class="p">2.489%</td></tr><tr><td>å¥½å‘€å®å® <span class="pill" style="margin-left:6px">SSR</span></td><td class="p">0.01%</td></tr><tr><td>????????ï¼ˆéšè—æ¬¾ï¼‰ <span class="pill" style="margin-left:6px">UR</span></td><td class="p">0.001%</td></tr><tr><td><em>æ€»è®¡</em></td><td class="p"><em>100.00%</em></td></tr></tbody>
          </table>
          <div class="notice">
            âš ï¸
            æœ¬é¡µé¢ä»…ç”¨äºå¨±ä¹ï¼ŒæŠ½å–ç»“æœéšæœºï¼Œæ¦‚ç‡å·²åœ¨ç•Œé¢å…¬å¼€æ˜¾ç¤ºã€‚ä½ å¯ä»¥è‡ªå®šä¹‰å¥–æ± æ–‡æœ¬ä¸æ¦‚ç‡ï¼Œå¸¦æ¥æ›´åˆç¾¤çš„æ¢—å‘³ä½“éªŒã€‚
          </div>
        </details>
      </section>

      <section class="panel" style="margin-top: 16px">
        <details>
          <summary style="cursor: pointer">
            <strong>è‡ªå®šä¹‰é…ç½®</strong>
            <span class="muted">ï¼ˆå¯å°†ä¸‹æ–¹ JSON ç²˜è´´è¦†ç›–ï¼‰</span>
          </summary>
          <div class="muted" style="margin: 8px 0">
            å­—æ®µï¼š<code>label</code> æ–‡æ¡ˆï¼Œ<code>weight</code> æ¦‚ç‡å æ¯”ï¼ˆæ€»å’Œ =
            100ï¼‰ï¼Œ<code>tag</code> æ ‡ç­¾ï¼ˆå¯é€‰ï¼šUR/SSR/SR/Rï¼‰ï¼Œ<code>type</code>
            è§¦å‘ç‰¹æ®Šæ•ˆæœï¼ˆå¯é€‰ï¼š<code>ur</code>ã€<code>ssr</code>ã€<code>image</code>ã€<code>quote</code>ï¼‰ã€‚
          </div>
          <textarea id="configArea" style="
              width: 100%;
              height: 180px;
              background: rgba(255, 255, 255, 0.5);
              color: var(--text);
              border: 1px solid var(--border);
              border-radius: 12px;
              padding: 10px;
              font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                monospace;
            "></textarea>
          <div class="flex" style="margin-top: 8px">
            <button class="btn" id="applyCfg">åº”ç”¨é…ç½®</button>
            <button class="btn ghost" id="resetCfg">è¿˜åŸé»˜è®¤</button>
          </div>
        </details>
      </section>
    </div>
    <!-- ç»“æœæ”¾å¤§ Modal -->
    <div class="modal" id="modal">
      <div class="inner">
        <div class="between" style="margin-bottom: 8px">
          <strong>æŠ½å–ç»“æœ</strong>
          <button class="btn ghost" id="closeModal">å…³é—­</button>
        </div>
        <div class="card big" id="modalCard">
          <span class="tag" id="modalTag"></span>
          <div class="resultText" id="modalText"></div>
        </div>
      </div>
    </div>
    <div class="announcement" id="announcement">
    </div><script>
      // ====== é…ç½®======
      const DEFAULT_POOL = [
        { label: "ç¥æ‚¨å¹´è½»æ¼‚äº®ï¼Œæœ‰æ´»åŠ›ã€‚", weight: 10, tag: "R" },
        { label: "è€å¸ˆï¼Œæ‚¨è¾›è‹¦äº†", weight: 10, tag: "R" },
        { label: "æ¡ƒæèŠ¬èŠ³ï¼Œæ„Ÿæ©æœ‰æ‚¨", weight: 10, tag: "R" },
        { label: "ç¥è€å¸ˆæ”¾å‡åˆæ—©åˆå¤š", weight: 10, tag: "R" },
        { label: "ä¸‰ç”Ÿæœ‰å¹¸ï¼Œå¾—æ‚¨ä¼´æˆ‘ä¸€ç¨‹é£é›ªï¼Œ", weight: 10, tag: "R" },
        { label: "ä¸‰å°ºè®²å°å­˜æ—¥æœˆï¼Œä¸€æ”¯ç²‰ç¬”å†™æ˜¥ç§‹ã€‚", weight: 5, tag: "SR" },
        { label: "æ„Ÿè°¢æ‚¨ä»¥çŸ¥è¯†ä¸ºç¯ï¼Œç…§äº®æˆ‘ä»¬å‰è¡Œçš„è·¯ã€‚", weight: 5, tag: "SR" },
        { label: "å¸ˆæ©å¦‚é…’ï¼Œé†‡åšç»µé•¿ï¼›å¸ˆæ©å¦‚ç¯ï¼Œæ¸©æš–æ˜äº®ã€‚", weight: 5, tag: "SR" },
        { label: "æ›¾ç»æ‡µæ‡‚æ±‚çŸ¥è·¯ï¼Œå¹¸å¾—æ‚¨æ‚‰å¿ƒæŒ‡å¼•ã€‚", weight: 5, tag: "SR" },
        { label: "ä¸€æ”¯ç²‰ç¬”ï¼Œä¸¤è¢–æ¸…é£ï¼Œä¸‰å°ºè®²å°ï¼Œå››å­£è€•è€˜ã€‚", weight: 5, tag: "SR" },
        { label: "æ•™å¸ˆèŠ‚åˆ°äº†ï¼Œæ„¿æ‚¨ç¬‘å®¹å¸¸ä¼´ï¼Œä¸‡äº‹æ— å¿§ï¼", weight: 5, tag: "SR" },
        { label: "ç¥æ‚¨äº‹äº‹é¡ºé‚ï¼Œæ¡ƒææ»¡å¤©ä¸‹ï¼", weight: 5, tag: "SR" },
        { label: "ç¬”å°–è€•è€˜æ¡ƒæåœ°ï¼Œé»˜æ°´æµ‡å¼€æ™ºæ…§èŠ±ã€‚", weight: 2.5, tag: "SR"},
        { label: "æ•™è¯²å¦‚æ˜¥é£ï¼Œå¸ˆæ©ä¼¼æµ·æ·±", weight: 2.5, tag: "SR"},
        { label: "æ¡ƒææ— éŸ³ï¼Œæ˜æœˆéšå¿ƒã€‚ç››è¡Œåƒé‡Œï¼Œä¸å¿˜å¸ˆæ©ã€‚", weight: 2.5, tag: "SR" },
        { label: "ä»¥ä¸€ç¯ä¼ è¯¸ç¯ï¼Œç»ˆè‡³ä¸‡ç¯çš†æ˜ã€‚", weight: 2.5, tag: "SR" },
        { label: "è¾›å‹¤çš„æ±—æ°´æ˜¯æ‚¨æ— ç§çš„å¥‰çŒ®ï¼Œæ¡ƒææ»¡å¤©ä¸‹æ˜¯æ‚¨æœ€é«˜çš„è£èª‰ã€‚", weight: 2.5, tag: "SR" },
        { label: "å¸ˆè€…è‹¥æ°´ï¼Œæ¶¦ç‰©æ— å£°ï¼Œæ¡ƒæäº‰å¦ï¼Œå››æµ·æ‰¿é£", weight: 2.5, tag: "SR" },
        { label: "æ˜¥èš•åˆ°æ­»ä¸æ–¹å°½ èœ¡ç‚¬æˆç°æ³ªå§‹å¹²", weight: 0.01, tag: "SSR", type: "ssr" },
        
      ];

      const PLACEHOLDER_SVGS = [
        '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 120"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#FFBD87"/><stop offset="1" stop-color="#A3D8F4"/></linearGradient></defs><rect width="100%" height="100%" fill="#F9F7F7"/><circle cx="90" cy="60" r="38" fill="url(#g)"/><rect x="120" y="40" width="50" height="40" rx="8" fill="#fff" opacity=".15"/></svg>',
        '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 120"><rect width="100%" height="100%" fill="#F9F7F7"/><g opacity=".9"><path d="M10 100 Q100 20 190 100" fill="none" stroke="#B5EAEA" stroke-width="6"/></g><circle cx="150" cy="38" r="12" fill="#FFBD87"/></svg>',
        '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 120"><rect width="100%" height="100%" fill="#F9F7F7"/><g><rect x="18" y="20" width="60" height="80" rx="10" fill="#A3D8F4" opacity=".5"/><rect x="88" y="28" width="60" height="64" rx="10" fill="#FFBD87" opacity=".6"/><rect x="158" y="36" width="24" height="48" rx="8" fill="#7DCFB6" opacity=".6"/></g></svg>',
      ];

      const colors = ["#FFBD87", "#A3D8F4", "#7DCFB6", "#B5EAEA"];
      const bgColor = "#F9F7F7";

      for (let i = 0; i < 100; i++) {
        const shapeType = Math.floor(Math.random() * 3); // 0: circle, 1: rect, 2: ellipse
        const shapes = [];

        const shapeCount = 2 + Math.floor(Math.random() * 3); // æ¯ä¸ª SVG 2~4 ä¸ªå½¢çŠ¶

        for (let j = 0; j < shapeCount; j++) {
          const x = 20 + Math.random() * 160;
          const y = 20 + Math.random() * 80;
          const w = 10 + Math.random() * 40;
          const h = 10 + Math.random() * 40;
          const r = 5 + Math.random() * 30;
          const fill = colors[Math.floor(Math.random() * colors.length)];
          const opacity = (0.5 + Math.random() * 0.4).toFixed(2);

          if (shapeType === 0) {
            shapes.push(
              `<circle cx="${x}" cy="${y}" r="${r}" fill="${fill}" opacity="${opacity}"/>`
            );
          } else if (shapeType === 1) {
            shapes.push(
              `<rect x="${x}" y="${y}" width="${w}" height="${h}" rx="${
                r / 2
              }" fill="${fill}" opacity="${opacity}"/>`
            );
          } else {
            shapes.push(
              `<ellipse cx="${x}" cy="${y}" rx="${w / 2}" ry="${
                h / 2
              }" fill="${fill}" opacity="${opacity}"/>`
            );
          }
        }

        const svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 120"><rect width="100%" height="100%" fill="${bgColor}"/><g>${shapes.join(
          ""
        )}</g></svg>`;
        PLACEHOLDER_SVGS.push(svg);
      }

      const QUOTES = [
        
      ];

      // ====== çŠ¶æ€ä¸ DOM ======
      let POOL = JSON.parse(JSON.stringify(DEFAULT_POOL));
      const roll1Btn = document.getElementById("roll1");
      const roll10Btn = document.getElementById("roll10");
      const clearBtn = document.getElementById("clear");
      const exportBtn = document.getElementById("export");
      const statusEl = document.getElementById("status");
      const rollzone = document.getElementById("rollzone");
      const historyEl = document.getElementById("history");
      const totalEl = document.getElementById("total");
      const probTableBody = document.querySelector("#probTable tbody");
      const configArea = document.getElementById("configArea");

      const modal = document.getElementById("modal");
      const closeModal = document.getElementById("closeModal");
      const modalCard = document.getElementById("modalCard");
      const modalText = document.getElementById("modalText");
      const modalTag = document.getElementById("modalTag");

      let HISTORY = []; // {ts, label, tag}
      const COUNTS = new Map();

      // æˆªæ­¢æ—¶é—´ï¼ˆæœ¬åœ°æ—¶åŒºï¼‰
      const DEADLINE = new Date("2025-09-10T23:59:59");

      function checkDeadline() {
        const now = new Date();
        const expired = now >= DEADLINE;
        roll1Btn.disabled = expired;
        roll10Btn.disabled = expired;
        statusEl.textContent = expired ? "æ´»åŠ¨å·²ç»“æŸ â›”" : "å°±ç»ª âœ…";
      }

      // åˆå§‹åŒ–æ¦‚ç‡è¡¨ & é…ç½®åŒº
      function renderProbTable() {
        probTableBody.innerHTML = "";
        let sum = 0;
        POOL.forEach((item) => (sum += Number(item.weight)));
        POOL.forEach((item) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${escapeHTML(
            item.tag === "UR" ? "????????ï¼ˆéšè—æ¬¾ï¼‰" : item.label
          )} <span class="pill" style="margin-left:6px">${
            item.tag || "R"
          }</span></td><td class="p">${Number(item.weight)}%</td>`;
          probTableBody.appendChild(tr);
        });
        const tr = document.createElement("tr");
        tr.innerHTML = `<td><em>æ€»è®¡</em></td><td class="p"><em>${sum.toFixed(
          2
        )}%</em></td>`;
        probTableBody.appendChild(tr);
      }

      function resetCounts() {
        COUNTS.clear();
        POOL.forEach((i) => COUNTS.set(i.label, 0));
      }

      function updateStats() {
        totalEl.textContent = `${HISTORY.length} æŠ½`;
        drawChart();
      }

      // åŠ æƒéšæœº
      function weightedPick() {
        const r = Math.random() * 100; // 0 ~ 100
        let acc = 0;
        for (const item of POOL) {
          acc += Number(item.weight);
          if (r <= acc) return item;
        }
        return POOL[POOL.length - 1];
      }

      // æ¸²æŸ“å•å¼ å¡ç‰‡
      function renderCard(result) {
        const card = document.createElement("div");
        card.className = "card " + result.tag.toLowerCase();
        const tag = document.createElement("span");
        tag.className = "tag";
        tag.textContent = result.tag || "R";
        const text = document.createElement("div");
        text.className = "resultText";

        // ç‰¹æ®Šç±»å‹å±•ç¤º
        if (result.type === "image") {
          const img = document.createElement("img");
          img.alt = result.label;
          img.style.maxWidth = "100%";
          img.style.maxHeight = "100%";
          img.style.borderRadius = "10px";
          img.src =
            "data:image/svg+xml;charset=utf-8," +
            encodeURIComponent(
              PLACEHOLDER_SVGS[
                Math.floor(Math.random() * PLACEHOLDER_SVGS.length)
              ]
            );
          text.appendChild(img);
          const small = document.createElement("div");
          small.textContent = result.label;
          small.className = "muted";
          small.style.marginTop = "6px";
          text.appendChild(small);
        } else if (result.type === "quote") {
          result.quote = QUOTES[Math.floor(Math.random() * QUOTES.length)];
          text.innerHTML = `<div style="font-size:18px; opacity:.95">â€œ${escapeHTML(
            result.quote
          )}â€</div><div class="muted" style="margin-top:6px">${escapeHTML(
            result.label
          )}</div>`;
        } else {
          text.textContent = result.label;
        }

        card.appendChild(tag);
        card.appendChild(text);

        // ç‚¹å‡»æ”¾å¤§
        card.addEventListener("click", () => openModalFor(result));
        return card;
      }

      function openModalFor(result) {
        modal.style.display = "grid";
        modalCard.className = "card big" + (result.tag === "SSR" ? " ssr" : "");
        modalText.innerHTML = "";
        modalTag.textContent = result.tag || "R";
        if (result.type === "image") {
          const img = document.createElement("img");
          img.alt = result.label;
          img.style.maxWidth = "100%";
          img.style.maxHeight = "100%";
          img.style.borderRadius = "10px";
          img.src =
            "data:image/svg+xml;charset=utf-8," +
            encodeURIComponent(
              PLACEHOLDER_SVGS[
                Math.floor(Math.random() * PLACEHOLDER_SVGS.length)
              ]
            );
          modalText.appendChild(img);
          const small = document.createElement("div");
          small.textContent = result.label;
          small.className = "muted";
          small.style.marginTop = "6px";
          modalText.appendChild(small);
        } else if (result.type === "quote") {
          modalText.innerHTML = `<div style="font-size:22px; opacity:.95">â€œ${escapeHTML(
            result.quote
          )}â€</div><div class="muted" style="margin-top:6px">${escapeHTML(
            result.label
          )}</div>`;
        } else {
          modalText.textContent = result.label;
        }
      }

      closeModal.addEventListener(
        "click",
        () => (modal.style.display = "none")
      );
      modal.addEventListener("click", (e) => {
        if (e.target === modal) modal.style.display = "none";
      });

      // å¼¹å¹•
      const barrage = document.getElementById("barrage");
      function shootBullet(text) {
        const span = document.createElement("span");
        span.className = "bullet";
        span.textContent = `å·²æŠ½å‡ºï¼š${text}`;
        const vh = Math.max(window.innerHeight * 0.8, 300);
        span.style.top = Math.round(Math.random() * (vh - 40)) + "px";
        const dur = 2 + Math.random() * 4; // 2~6s
        span.style.animationDuration = dur + "s";
        barrage.appendChild(span);
        setTimeout(() => span.remove(), dur * 1000 + 200);
      }

      // ç®€æ˜“çƒŸèŠ±å½©å¸¦ï¼ˆSSRï¼‰
      const confetti = document.getElementById("confetti");
      function boomConfetti() {
        for (let i = 0; i < 180; i++) {
          const s = document.createElement("span");
          s.style.left = Math.random() * 100 + "vw";
          s.style.top = "-10px";
          const rot = Math.random() * 360;
          const dur = 1500 + Math.random() * 1200;
          s.animate(
            [
              { transform: `translateY(0) rotate(${rot}deg)`, opacity: 1 },
              {
                transform: `translateY(100vh) rotate(${rot + 360}deg)`,
                opacity: 0.8,
              },
            ],
            {
              duration: dur,
              easing: "cubic-bezier(.12,.78,.22,1)",
              fill: "forwards",
            }
          );
          confetti.appendChild(s);
          setTimeout(() => s.remove(), dur + 100);
        }
      }

      function boomFirework() {
        const count = 9;
        for (let j = 0; j < count; j++) {
          setTimeout(() => {
            const x =
              Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1;
            const y = Math.random() * (window.innerHeight / 2) + 120;

            // ç«ç®­æœ¬ä½“
            const rocket = document.createElement("span");
            rocket.style.position = "fixed";
            rocket.style.left = x + "px";
            rocket.style.top = window.innerHeight + "px";
            rocket.style.width = "4px";
            rocket.style.height = "18px";
            rocket.style.background = "white";
            rocket.style.borderRadius = "2px";
            rocket.style.boxShadow = "0 0 8px white";
            rocket.style.zIndex = 9999;
            document.body.appendChild(rocket);

            // è½¨è¿¹åŠ¨ç”»
            const rocketAnim = rocket.animate(
              [
                { transform: `translateY(0)`, opacity: 1 },
                {
                  transform: `translateY(-${window.innerHeight - y}px)`,
                  opacity: 1,
                },
              ],
              {
                duration: 1500,
                easing: "cubic-bezier(.2,.8,.4,1)",
                fill: "forwards",
              }
            );

            // === å°¾ç„°æ‹–å½± ===
            const trailInterval = setInterval(() => {
              const trail = document.createElement("span");
              trail.style.position = "fixed";
              trail.style.left = x + Math.random() * 6 - 3 + "px";
              trail.style.top = rocket.getBoundingClientRect().top + "px";
              trail.style.width = "5px";
              trail.style.height = "5px";
              trail.style.borderRadius = "50%";
              trail.style.background = "orange";
              trail.style.boxShadow = "0 0 8px orange, 0 0 15px yellow";
              trail.style.zIndex = 9999;
              document.body.appendChild(trail);

              const dur = 500 + Math.random() * 300;
              trail.animate(
                [
                  { transform: "scale(1)", opacity: 1 },
                  { transform: "scale(0.2)", opacity: 0 },
                ],
                { duration: dur, easing: "ease-out", fill: "forwards" }
              );
              setTimeout(() => trail.remove(), dur + 50);
            }, 50);

            // ç«ç®­åˆ°è¾¾åçˆ†ç‚¸
            rocketAnim.onfinish = () => {
              clearInterval(trailInterval);
              rocket.remove();

              // === çˆ†ç‚¸é—ªå…‰ ===
              const flash = document.createElement("div");
              flash.style.position = "fixed";
              flash.style.left = x - 50 + "px";
              flash.style.top = y - 50 + "px";
              flash.style.width = "100px";
              flash.style.height = "100px";
              flash.style.borderRadius = "50%";
              flash.style.background = "radial-gradient(white, transparent)";
              flash.style.opacity = 0;
              flash.style.zIndex = 9998;
              document.body.appendChild(flash);

              flash.animate(
                [
                  { opacity: 0, transform: "scale(0.3)" },
                  { opacity: 1, transform: "scale(1.2)" },
                  { opacity: 0, transform: "scale(1.5)" },
                ],
                { duration: 300, easing: "ease-out", fill: "forwards" }
              );
              setTimeout(() => flash.remove(), 400);

              // çˆ†ç‚¸ç²’å­
              for (let i = 0; i < 150; i++) {
                const p = document.createElement("span");
                p.style.position = "fixed";
                p.style.left = x + "px";
                p.style.top = y + "px";
                p.style.width = "6px";
                p.style.height = "6px";
                p.style.borderRadius = "50%";
                const color = `hsl(${Math.random() * 360}, 100%, 60%)`;
                p.style.background = color;
                p.style.boxShadow = `0 0 15px ${color}, 0 0 30px ${color}`;
                p.style.zIndex = 9999;
                document.body.appendChild(p);

                const angle = Math.random() * 2 * Math.PI;
                const dist = 120 + Math.random() * 180;
                const dx = Math.cos(angle) * dist;
                const dy = Math.sin(angle) * dist;
                const dur = 1800 + Math.random() * 1200;

                p.animate(
                  [
                    { transform: "translate(0,0) scale(1)", opacity: 1 },
                    {
                      transform: `translate(${dx}px,${dy}px) scale(${
                        0.3 + Math.random() * 0.5
                      })`,
                      opacity: 0,
                    },
                  ],
                  {
                    duration: dur,
                    easing: "cubic-bezier(.1,.7,.2,1)",
                    fill: "forwards",
                  }
                );

                setTimeout(() => p.remove(), dur + 200);
              }
            };
          }, j * 1000);
        }
      }

      // å†å²è®°å½•
      function pushHistory(item) {
        HISTORY.push({
          ts: Date.now(),
          label: item.label,
          tag: item.tag || "R",
        });
        COUNTS.set(item.label, (COUNTS.get(item.label) || 0) + 1);
        const h = document.createElement("div");
        h.className = "historyItem";
        h.innerHTML = `<span class="pill">${
          item.tag || "R"
        }</span><span>${escapeHTML(
          item.label
        )}</span><span class="muted" style="margin-left:auto">${new Date().toLocaleTimeString()}</span>`;
        historyEl.prepend(h);
        // é™åˆ¶å…ƒç´ æ•°é‡
        while (historyEl.children.length > 1000) {
          historyEl.removeChild(historyEl.lastChild);
        }
      }

      // ç»˜åˆ¶ç»Ÿè®¡æ¡å½¢å›¾
      const chart = document.getElementById("chart");
      const ctx = chart.getContext("2d");
      function drawChart() {
        const dpr = window.devicePixelRatio || 1;
        const { width, height } = chart.getBoundingClientRect();
        chart.width = width * dpr;
        chart.height = height * dpr;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        ctx.clearRect(0, 0, width, height);
        const labels = POOL.map((i) => (i.tag === "SSR" ? "SSR" : ""));
        const counts = POOL.map((i) => COUNTS.get(i.label) || 0);
        const max = Math.max(1, ...counts);
        const barW = Math.max(6, (width - 40) / counts.length - 6);
        ctx.fillStyle = "rgba(255,255,255,.3)";
        ctx.fillRect(0, 0, width, height);
        ctx.fillStyle = "#5A6270AA";
        ctx.fillText("æ¬¡æ•°", 8, 14);
        counts.forEach((v, i) => {
          const x = 20 + i * (barW + 6);
          const h = Math.ceil((v / max) * (height - 40));
          ctx.fillStyle =
            POOL[i].tag === "SR"
              ? "#A3D8F4"
              : POOL[i].tag === "SSR"
              ? "#FFBD87"
              : POOL[i].tag === "UR"
              ? "#B19CD9"
              : "#B5EAEA";
          ctx.fillRect(x, height - 20 - h, barW, h);
          // ctx.fillStyle = "#5A6270AA";
          // ctx.fillText(v, x , height - 26 - h);
        });
      }

      // å·¥å…·
      function escapeHTML(s) {
        return (s + "").replace(
          /[&<>"']/g,
          (c) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[c])
        );
      }

      // æŠ½å¡æµç¨‹
      function doRoll(times) {
        roll1Btn.disabled = true;
        roll10Btn.disabled = true;
        const zone = rollzone;
        zone.innerHTML = "";
        for (let i = 0; i < times; i++) {
          // åŠ¨ç”»å»¶æ—¶ï¼šåè¿é¡ºæ¬¡ç¿»ç‰Œ
          setTimeout(() => {
            const item = weightedPick();
            const card = renderCard(item);
            zone.appendChild(card);
            // å°ç¿»è½¬åŠ¨ç”»
            card.animate(
              [
                { transform: "rotateY(88deg) scale(.9)", opacity: 0.2 },
                { transform: "rotateY(0) scale(1)", opacity: 1 },
              ],
              { duration: 1200, easing: "cubic-bezier(.2,.9,.2,1)" }
            );

            pushHistory(item);
            shootBullet(`${item.tag || "R"} Â· ${item.label}`);
            updateStats();

           
            if (i == times - 1) {
              roll1Btn.disabled = false;
              roll10Btn.disabled = false;
            }
          }, i * 260);
        }
      }

      // å¯¼å‡º
      function exportJSON() {
        const data = {
          history: HISTORY,
          counts: Object.fromEntries(COUNTS),
          pool: POOL,
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "gacha_export.json";
        a.click();
        URL.revokeObjectURL(url);
      }

      // é…ç½®åº”ç”¨
      function applyConfig(json) {
        try {
          const arr = JSON.parse(json);
          const sum = arr.reduce((s, i) => s + Number(i.weight || 0), 0);
          if (Math.abs(sum - 100) > 1e-6)
            throw new Error("æ¦‚ç‡æ€»å’Œéœ€ä¸º 100ï¼Œç›®å‰ä¸º " + sum);
          if (!arr.length) throw new Error("é…ç½®ä¸ºç©º");
          POOL = arr;
          resetCounts();
          HISTORY = [];
          historyEl.innerHTML = "";
          rollzone.innerHTML = "";
          updateStats();
          renderProbTable();
          statusEl.textContent = "å·²åº”ç”¨æ–°é…ç½® âœ…";
        } catch (err) {
          alert("é…ç½®é”™è¯¯ï¼š" + err.message);
        }
      }

      // ç»‘å®š
      roll1Btn.addEventListener("click", () => doRoll(1));
      roll10Btn.addEventListener("click", () => doRoll(10));
      clearBtn.addEventListener("click", () => {
        HISTORY = [];
        historyEl.innerHTML = "";
        resetCounts();
        updateStats();
        statusEl.textContent = "å·²æ¸…ç©º ğŸ§¹";
        rollzone.innerHTML = "";
      });
      exportBtn.addEventListener("click", exportJSON);

      document
        .getElementById("applyCfg")
        .addEventListener("click", () => applyConfig(configArea.value));
      document.getElementById("resetCfg").addEventListener("click", () => {
        configArea.value = JSON.stringify(DEFAULT_POOL, null, 2);
        applyConfig(configArea.value);
      });

      // é¦–æ¬¡æ¸²æŸ“
      // checkDeadline();
      renderProbTable();
      resetCounts();
      updateStats();
      configArea.value = JSON.stringify(DEFAULT_POOL, null, 2);

      const announcement = document.getElementById("announcement");
      const closeBtn = document.getElementById("closeAnnouncement");

      // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤º
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth() + 1;
      const date = today.getDate();

      if (year === 2025 && month === 8 && date === 29) {
        window.addEventListener("load", () => {
          setTimeout(() => {
            announcement.classList.add("show");
          }, 500);
        });
      }

      // å…³é—­å…¬å‘Šæ 
      closeBtn.addEventListener("click", () => {
        announcement.classList.remove("show");
      });
      // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æˆªæ­¢
      // setInterval(checkDeadline, 60000);

      function autoRoll(times = 100) {
        const zone = rollzone;
        zone.innerHTML = "";
        for (let i = 0; i < times; i++) {
          setTimeout(() => {
            const item = weightedPick();
            const card = renderCard(item);
            zone.appendChild(card);

            pushHistory(item);
            updateStats();

          
          }, 0);
        }
      }

      // è‡ªåŠ¨åŒ–
      // rollInterval = setInterval(autoRoll, 100);
      // å¦‚æœéœ€è¦åœæ­¢è½®è¯¢ï¼Œå¯ä»¥è°ƒç”¨
      // clearInterval(rollInterval);
    </script>
</body>
</html>